<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tomsung.agdc.mapper.ProficientCropMapper">
  <resultMap id="BaseResultMap" type="com.tomsung.agdc.domain.ProficientCropKey">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="USERID" jdbcType="INTEGER" property="userid" />
    <id column="CROP_ID" jdbcType="INTEGER" property="cropId" />
    <result column="TIME" javaType="DATE" property="time"/>
    <result column="expertCount" jdbcType="INTEGER" property="expertCount"/>
    <association property="user" javaType="com.tomsung.agdc.domain.User">
    	<result column="USERNAME" jdbcType="VARCHAR" property="username" />
    	<result column="PROVINCE_NAME" jdbcType="VARCHAR" property="privinceName" />
	    <result column="CITY_NAME" jdbcType="VARCHAR" property="cityName" />
	    <result column="DISTRICT_NAME" jdbcType="VARCHAR" property="districtName" />

    </association>
	<association property="crop" javaType="com.tomsung.agdc.domain.Crop">
		<result column="CROP_NAME" jdbcType="VARCHAR" property="cropName" />
    </association>
	<association property="questionReplyRecord" javaType="com.tomsung.agdc.domain.QuestionReplyRecord">
		<result column="REPLY_COUNT" jdbcType="INTEGER" property="replyCount" />
    </association>
    
    
  </resultMap>
  
  <select id="selectAllProficients" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
	SELECT u.USERNAME, u.PROVINCE_NAME, u.CITY_NAME, u.DISTRICT_NAME, u.ADDRESS, c.CROP_NAME, qrr.REPLY_COUNT
    FROM PROFICIENT_CROP pc, USER u, CROP c, QUESTION_REPLY_RECORD qrr
	where pc.CROP_ID = c.CROP_ID
	and pc.USERID = u.USERID
    and qrr.USERID = u.USERID
    AND qrr.CROP_ID = c.CROP_ID
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="com.tomsung.agdc.domain.ProficientCropKey">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from PROFICIENT_CROP
    where USERID = #{userid,jdbcType=INTEGER}
      and CROP_ID = #{cropId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.tomsung.agdc.domain.ProficientCropKey">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into PROFICIENT_CROP (USERID, CROP_ID)
    values (#{userid,jdbcType=INTEGER}, #{cropId,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.tomsung.agdc.domain.ProficientCropKey">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into PROFICIENT_CROP
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="userid != null">
        USERID,
      </if>
      <if test="cropId != null">
        CROP_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="userid != null">
        #{userid,jdbcType=INTEGER},
      </if>
      <if test="cropId != null">
        #{cropId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>

  <select id="selectCropCount" resultType="java.lang.Integer">
    SELECT COUNT(DISTINCT CROP_ID) from PROFICIENT_CROP;
  </select>
  <select id="selectMonthCropCount" resultType="java.lang.Integer">
    <![CDATA[
      select COUNT(DISTINCT CROP_ID) from (SELECT CROP_ID from PROFICIENT_CROP where TIME>=#{date})as a
      where a.CROP_ID not in (SELECT CROP_ID from PROFICIENT_CROP where TIME<#{date});
    ]]>
  </select>

  <select id="selectConsistOfCrop" resultMap="BaseResultMap">
    select c.CROP_NAME,COUNT(1) as expertCount from PROFICIENT_CROP p,CROP c where c.CROP_ID=p.CROP_ID  GROUP BY p.CROP_ID order by expertCount;
  </select>
</mapper>