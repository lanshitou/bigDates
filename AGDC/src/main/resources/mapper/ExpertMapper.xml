<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tomsung.agdc.mapper.ExpertMapper">
    <resultMap id="BaseResultMap" type="com.tomsung.agdc.domain.Expert">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="ID" jdbcType="INTEGER" property="id"/>
        <result column="USERID" jdbcType="INTEGER" property="userid"/>
        <result column="MOBILE_PHONE" jdbcType="VARCHAR" property="mobilePhone"/>
        <result column="REALNAME" jdbcType="VARCHAR" property="realname"/>
        <result column="EXPERT_TYPE" jdbcType="VARCHAR" property="expertType"/>
        <result column="EVALUTION_COUNT" jdbcType="INTEGER" property="evalutionCount"/>
        <result column="AVG" jdbcType="DOUBLE" property="avg"/>
        <result column="CROP_NAME" jdbcType="VARCHAR" property="cropName"/>
        <result column="CROP_COUNT" jdbcType="INTEGER" property="cropCount"/>
        <result column="REPLY_COUNT" jdbcType="INTEGER" property="replyCount"/>
        <result column="PROVINCE_NAME" jdbcType="VARCHAR" property="provinceName"/>
        <result column="CITY_NAME" jdbcType="VARCHAR" property="cityName"/>
        <result column="DISTRICT_NAME" jdbcType="VARCHAR" property="districtName"/>
        <result column="VERIFIED_TIME" jdbcType="DATE" property="verifiedTime"/>
        <result column="ADDRESS" jdbcType="VARCHAR" property="address"/>
        <result column="ADD_X" jdbcType="DOUBLE" property="add_x"/>
        <result column="ADD_Y" jdbcType="DOUBLE" property="add_y"/>
        <result column="c" jdbcType="INTEGER" property="liveness"/>
        <result column="typeCount" jdbcType="INTEGER" property="typeCount"/>
        <result column="expertCount" jdbcType="INTEGER" property="expertCount"/>
        <result column="replyCount" jdbcType="INTEGER" property="replyCountByProvince"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        ID, USERID, MOBILE_PHONE, REALNAME, EXPERT_TYPE, EVALUTION_COUNT, AVG, CROP_NAME,
        CROP_COUNT, REPLY_COUNT, PROVINCE_NAME, CITY_NAME, DISTRICT_NAME, ADDRESS, VERIFIED_TIME
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from EXPERT
        where ID = #{id,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from EXPERT
        where ID = #{id,jdbcType=INTEGER}
    </delete>
    <insert id="insert" parameterType="com.tomsung.agdc.domain.Expert">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into EXPERT (ID, USERID, MOBILE_PHONE,
        REALNAME, EXPERT_TYPE, EVALUTION_COUNT,
        AVG, CROP_NAME, CROP_COUNT,
        REPLY_COUNT, PROVINCE_NAME, CITY_NAME,
        DISTRICT_NAME, VERIFIED_TIME)
        values (#{id,jdbcType=INTEGER}, #{userid,jdbcType=INTEGER}, #{mobilePhone,jdbcType=VARCHAR},
        #{realname,jdbcType=VARCHAR}, #{expertType,jdbcType=VARCHAR}, #{evalutionCount,jdbcType=INTEGER},
        #{avg,jdbcType=DOUBLE}, #{cropName,jdbcType=VARCHAR}, #{cropCount,jdbcType=INTEGER},
        #{replyCount,jdbcType=INTEGER}, #{provinceName,jdbcType=VARCHAR}, #{cityName,jdbcType=VARCHAR},
        #{districtName,jdbcType=VARCHAR}, #{verifiedTime,jdbcType=DATE})
    </insert>
    <insert id="insertSelective" parameterType="com.tomsung.agdc.domain.Expert">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into EXPERT
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                ID,
            </if>
            <if test="userid != null">
                USERID,
            </if>
            <if test="mobilePhone != null">
                MOBILE_PHONE,
            </if>
            <if test="realname != null">
                REALNAME,
            </if>
            <if test="expertType != null">
                EXPERT_TYPE,
            </if>
            <if test="evalutionCount != null">
                EVALUTION_COUNT,
            </if>
            <if test="avg != null">
                AVG,
            </if>
            <if test="cropName != null">
                CROP_NAME,
            </if>
            <if test="cropCount != null">
                CROP_COUNT,
            </if>
            <if test="replyCount != null">
                REPLY_COUNT,
            </if>
            <if test="provinceName != null">
                PROVINCE_NAME,
            </if>
            <if test="cityName != null">
                CITY_NAME,
            </if>
            <if test="districtName != null">
                DISTRICT_NAME,
            </if>
            <if test="verifiedTime != null">
                VERIFIED_TIME,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="userid != null">
                #{userid,jdbcType=INTEGER},
            </if>
            <if test="mobilePhone != null">
                #{mobilePhone,jdbcType=VARCHAR},
            </if>
            <if test="realname != null">
                #{realname,jdbcType=VARCHAR},
            </if>
            <if test="expertType != null">
                #{expertType,jdbcType=VARCHAR},
            </if>
            <if test="evalutionCount != null">
                #{evalutionCount,jdbcType=INTEGER},
            </if>
            <if test="avg != null">
                #{avg,jdbcType=DOUBLE},
            </if>
            <if test="cropName != null">
                #{cropName,jdbcType=VARCHAR},
            </if>
            <if test="cropCount != null">
                #{cropCount,jdbcType=INTEGER},
            </if>
            <if test="replyCount != null">
                #{replyCount,jdbcType=INTEGER},
            </if>
            <if test="provinceName != null">
                #{provinceName,jdbcType=VARCHAR},
            </if>
            <if test="cityName != null">
                #{cityName,jdbcType=VARCHAR},
            </if>
            <if test="districtName != null">
                #{districtName,jdbcType=VARCHAR},
            </if>
            <if test="verifiedTime != null">
                #{verifiedTime,jdbcType=DATE},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.tomsung.agdc.domain.Expert">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update EXPERT
        <set>
            <if test="userid != null">
                USERID = #{userid,jdbcType=INTEGER},
            </if>
            <if test="mobilePhone != null">
                MOBILE_PHONE = #{mobilePhone,jdbcType=VARCHAR},
            </if>
            <if test="realname != null">
                REALNAME = #{realname,jdbcType=VARCHAR},
            </if>
            <if test="expertType != null">
                EXPERT_TYPE = #{expertType,jdbcType=VARCHAR},
            </if>
            <if test="evalutionCount != null">
                EVALUTION_COUNT = #{evalutionCount,jdbcType=INTEGER},
            </if>
            <if test="avg != null">
                AVG = #{avg,jdbcType=DOUBLE},
            </if>
            <if test="cropName != null">
                CROP_NAME = #{cropName,jdbcType=VARCHAR},
            </if>
            <if test="cropCount != null">
                CROP_COUNT = #{cropCount,jdbcType=INTEGER},
            </if>
            <if test="replyCount != null">
                REPLY_COUNT = #{replyCount,jdbcType=INTEGER},
            </if>
            <if test="provinceName != null">
                PROVINCE_NAME = #{provinceName,jdbcType=VARCHAR},
            </if>
            <if test="cityName != null">
                CITY_NAME = #{cityName,jdbcType=VARCHAR},
            </if>
            <if test="districtName != null">
                DISTRICT_NAME = #{districtName,jdbcType=VARCHAR},
            </if>
            <if test="verifiedTime != null">
                VERIFIED_TIME = #{verifiedTime,jdbcType=DATE},
            </if>
        </set>
        where ID = #{id,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.tomsung.agdc.domain.Expert">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update EXPERT
        set USERID = #{userid,jdbcType=INTEGER},
        MOBILE_PHONE = #{mobilePhone,jdbcType=VARCHAR},
        REALNAME = #{realname,jdbcType=VARCHAR},
        EXPERT_TYPE = #{expertType,jdbcType=VARCHAR},
        EVALUTION_COUNT = #{evalutionCount,jdbcType=INTEGER},
        AVG = #{avg,jdbcType=DOUBLE},
        CROP_NAME = #{cropName,jdbcType=VARCHAR},
        CROP_COUNT = #{cropCount,jdbcType=INTEGER},
        REPLY_COUNT = #{replyCount,jdbcType=INTEGER},
        PROVINCE_NAME = #{provinceName,jdbcType=VARCHAR},
        CITY_NAME = #{cityName,jdbcType=VARCHAR},
        DISTRICT_NAME = #{districtName,jdbcType=VARCHAR},
        VERIFIED_TIME = #{verifiedTime,jdbcType=DATE}
        where ID = #{id,jdbcType=INTEGER}
    </update>
    <resultMap id="ListResultMap" type="com.tomsung.agdc.vo.ExpertListItemVO">
        <result property="userId" column="USERID"/>
        <result property="cropName" column="CROP_NAME"/>
        <result property="name" column="REALNAME"/>
        <result property="address" column="ADDRESS"/>
        <result property="type" column="EXPERT_TYPE"/>
        <result property="intro" column="INTRO"/>
        <result property="tel" column="MOBILE_PHONE"/>
        <result property="age" column="AGE"/>
        <result property="sex" column="SEX"/>
        <result property="postCount" column="POST_COUNT"/>
        <result property="replyCount" column="REPLY_COUNT"/>
        <result property="scoreAvg" column="AVG"/>
        <result property="verifiedTime" column="VERIFIED_TIME"/>
        <result property="oneYearPost" column="ONE_YEAR_POST"/>
        <result property="oneYearReply" column="ONE_YEAR_REPLY"/>
        <result property="liveness" column="LIVENESS"/>
    </resultMap>
    <resultMap id="RankMap" type="com.tomsung.agdc.vo.RankVo">
        <result property="name" column="real_name"/>
        <result property="value" column="value"/>
    </resultMap>
    <select id="selectExpertCount" resultType="java.lang.Integer">
        select count(USERID) from EXPERT
        <where>
            <if test="date !=null">
                and VERIFIED_TIME>#{date,jdbcType=TIMESTAMP}
            </if>
        </where>
    </select>
    <select id="selectDistrictCount" resultType="java.lang.Integer">
    select count(USERID) from EXPERT
  </select>
    <select id="selectMonthDistrictCount" resultType="java.lang.Integer">
    <![CDATA[
    select COUNT(DISTINCT DISTRICT_NAME) from (SELECT DISTRICT_NAME from EXPERT where VERIFIED_TIME>#{date}) as a where a.DISTRICT_NAME not in
    (SELECT DISTRICT_NAME from EXPERT where VERIFIED_TIME<=#{date})
        ]]>
  </select>
    <select id="selectReplyCount" resultType="java.lang.Integer">
        select sum(REPLY_COUNT) from EXPERT
    </select>
    <select id="selectEvalutionCount" resultType="java.lang.Integer">
        select sum(EVALUTION_COUNT) from EXPERT
    </select>
    <select id="selectExpertLiveness" resultMap="BaseResultMap">
        select e.REALNAME,COUNT(1) c from OPERATELOG o,EXPERT e
        where e.USERID=o.USEID AND (o.USERTYPE=1 or o.USERTYPE=2)
        GROUP BY USERID
        ORDER BY c DESC limit 0,5;
    </select>
    <select id="selectExpertEvalution" resultMap="BaseResultMap">
        select REALNAME,AVG from EXPERT ORDER BY AVG DESC limit 0,5;
    </select>
    <select id="selectExpertType" resultMap="BaseResultMap">
        select EXPERT_TYPE,count(EXPERT_TYPE) as typeCount from EXPERT GROUP BY EXPERT_TYPE;
    </select>
    <select id="selectExpertInfoByProvince" resultMap="BaseResultMap">
       SELECT a.PROVINCE_NAME,expertCount,IFNULL(replyCount,0) as replyCount from (SELECT PROVINCE_NAME,COUNT(1) as expertCount FROM EXPERT GROUP BY PROVINCE_NAME) as a
       LEFT JOIN (select e.PROVINCE_NAME,COUNT(DISTINCT QUESTION_ID) as replyCount from REPLY r,EXPERT e where r.USER_ID =e.USERID GROUP BY e.PROVINCE_NAME) as b
       on a.PROVINCE_NAME=b.PROVINCE_NAME ORDER BY expertCount DESC;
    </select>
    <select id="selectExpertInfo" resultMap="BaseResultMap">
        select ID,REALNAME,EXPERT_TYPE,CROP_NAME,REPLY_COUNT,PROVINCE_NAME,CITY_NAME,ifnull(DISTRICT_NAME,"") as DISTRICT_NAME,ADDRESS,AVG,MOBILE_PHONE,ADD_X,ADD_Y,VERIFIED_TIME
        from EXPERT
    </select>
    <select id="selectList" resultMap="ListResultMap">
        SELECT USERID, CROP_NAME, REALNAME, CONCAT(PROVINCE_NAME,CITY_NAME,DISTRICT_NAME,ADDRESS) ADDRESS,
        EXPERT_TYPE, INTRO, MOBILE_PHONE, AGE, SEX, POST_COUNT, REPLY_COUNT, AVG,
        VERIFIED_TIME, ONE_YEAR_POST, ONE_YEAR_REPLY, LIVENESS
        FROM EXPERT
        <where>
            <if test="keyword != null and keyword != ''">
                REALNAME like #{keyword} or MOBILE_PHONE like #{keyword}
            </if>
        </where>
    </select>
    <select id="selectLivenessTop10" resultMap="RankMap">
        SELECT REALNAME real_name, (ONE_YEAR_POST + ONE_YEAR_REPLY) as value
        FROM EXPERT
        ORDER BY (ONE_YEAR_POST + ONE_YEAR_REPLY) DESC limit 10
    </select>
    <select id="selectGradeTop10" resultMap="RankMap">
        SELECT REALNAME real_name, AVG as value
        FROM EXPERT
        ORDER BY AVG DESC limit 10
    </select>
    <update id="updateLongtitude" >
       update EXPERT set ADD_Y = #{lon},ADD_X =#{lat} where ID=#{id};
    </update>
</mapper>